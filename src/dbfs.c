/*
 * dbfs.c
 *
 *  Created on: Apr 26, 2019
 *      Author: iansc
 */


#include "dbfs.h"

//struct to represent a float value using integers
typedef struct {
	uint8_t num;
	uint16_t dec;
} flt;

//python code to generate look up table:
//for i in range(0,5001):
//    if(i%10==0):
//        j=round((6.0206*(i/1000) +1.761),3)
//        print("[%d] = {%d,%d}," % (i/10,j, (j%1)*1000))

//lookup table of DBFS in values between 0 to 5V
static const flt dbfs[] = {
		[0] = {1,760},
		[1] = {1,821},
		[2] = {1,881},
		[3] = {1,942},
		[4] = {2,1},
		[5] = {2,61},
		[6] = {2,121},
		[7] = {2,181},
		[8] = {2,242},
		[9] = {2,302},
		[10] = {2,363},
		[11] = {2,423},
		[12] = {2,483},
		[13] = {2,544},
		[14] = {2,604},
		[15] = {2,664},
		[16] = {2,724},
		[17] = {2,785},
		[18] = {2,845},
		[19] = {2,904},
		[20] = {2,964},
		[21] = {3,24},
		[22] = {3,85},
		[23] = {3,145},
		[24] = {3,205},
		[25] = {3,266},
		[26] = {3,326},
		[27] = {3,387},
		[28] = {3,447},
		[29] = {3,507},
		[30] = {3,567},
		[31] = {3,626},
		[32] = {3,688},
		[33] = {3,748},
		[34] = {3,807},
		[35] = {3,867},
		[36] = {3,927},
		[37] = {3,988},
		[38] = {4,49},
		[39] = {4,108},
		[40] = {4,168},
		[41] = {4,229},
		[42] = {4,290},
		[43] = {4,349},
		[44] = {4,410},
		[45] = {4,469},
		[46] = {4,530},
		[47] = {4,591},
		[48] = {4,650},
		[49] = {4,711},
		[50] = {4,770},
		[51] = {4,831},
		[52] = {4,892},
		[53] = {4,952},
		[54] = {5,11},
		[55] = {5,72},
		[56] = {5,133},
		[57] = {5,192},
		[58] = {5,253},
		[59] = {5,312},
		[60] = {5,373},
		[61] = {5,434},
		[62] = {5,493},
		[63] = {5,554},
		[64] = {5,613},
		[65] = {5,674},
		[66] = {5,735},
		[67] = {5,794},
		[68] = {5,855},
		[69] = {5,915},
		[70] = {5,974},
		[71] = {6,35},
		[72] = {6,96},
		[73] = {6,155},
		[74] = {6,216},
		[75] = {6,275},
		[76] = {6,336},
		[77] = {6,397},
		[78] = {6,456},
		[79] = {6,517},
		[80] = {6,577},
		[81] = {6,637},
		[82] = {6,698},
		[83] = {6,758},
		[84] = {6,817},
		[85] = {6,878},
		[86] = {6,939},
		[87] = {6,998},
		[88] = {7,59},
		[89] = {7,118},
		[90] = {7,179},
		[91] = {7,240},
		[92] = {7,299},
		[93] = {7,360},
		[94] = {7,419},
		[95] = {7,480},
		[96] = {7,541},
		[97] = {7,601},
		[98] = {7,660},
		[99] = {7,721},
		[100] = {7,782},
		[101] = {7,841},
		[102] = {7,902},
		[103] = {7,961},
		[104] = {8,22},
		[105] = {8,83},
		[106] = {8,143},
		[107] = {8,202},
		[108] = {8,262},
		[109] = {8,323},
		[110] = {8,384},
		[111] = {8,444},
		[112] = {8,503},
		[113] = {8,564},
		[114] = {8,624},
		[115] = {8,685},
		[116] = {8,744},
		[117] = {8,804},
		[118] = {8,865},
		[119] = {8,926},
		[120] = {8,986},
		[121] = {9,45},
		[122] = {9,105},
		[123] = {9,166},
		[124] = {9,227},
		[125] = {9,287},
		[126] = {9,346},
		[127] = {9,407},
		[128] = {9,467},
		[129] = {9,528},
		[130] = {9,587},
		[131] = {9,647},
		[132] = {9,708},
		[133] = {9,768},
		[134] = {9,829},
		[135] = {9,888},
		[136] = {9,948},
		[137] = {10,9},
		[138] = {10,69},
		[139] = {10,130},
		[140] = {10,189},
		[141] = {10,250},
		[142] = {10,310},
		[143] = {10,369},
		[144] = {10,430},
		[145] = {10,490},
		[146] = {10,551},
		[147] = {10,611},
		[148] = {10,670},
		[149] = {10,731},
		[150] = {10,791},
		[151] = {10,852},
		[152] = {10,912},
		[153] = {10,973},
		[154] = {11,32},
		[155] = {11,92},
		[156] = {11,153},
		[157] = {11,212},
		[158] = {11,273},
		[159] = {11,333},
		[160] = {11,394},
		[161] = {11,454},
		[162] = {11,513},
		[163] = {11,574},
		[164] = {11,634},
		[165] = {11,695},
		[166] = {11,755},
		[167] = {11,814},
		[168] = {11,875},
		[169] = {11,936},
		[170] = {11,996},
		[171] = {12,55},
		[172] = {12,115},
		[173] = {12,176},
		[174] = {12,237},
		[175] = {12,297},
		[176] = {12,356},
		[177] = {12,416},
		[178] = {12,477},
		[179] = {12,538},
		[180] = {12,598},
		[181] = {12,657},
		[182] = {12,718},
		[183] = {12,778},
		[184] = {12,839},
		[185] = {12,898},
		[186] = {12,958},
		[187] = {13,19},
		[188] = {13,80},
		[189] = {13,140},
		[190] = {13,199},
		[191] = {13,259},
		[192] = {13,320},
		[193] = {13,381},
		[194] = {13,441},
		[195] = {13,500},
		[196] = {13,561},
		[197] = {13,621},
		[198] = {13,682},
		[199] = {13,742},
		[200] = {13,801},
		[201] = {13,862},
		[202] = {13,923},
		[203] = {13,983},
		[204] = {14,42},
		[205] = {14,102},
		[206] = {14,163},
		[207] = {14,224},
		[208] = {14,284},
		[209] = {14,343},
		[210] = {14,403},
		[211] = {14,464},
		[212] = {14,525},
		[213] = {14,585},
		[214] = {14,644},
		[215] = {14,705},
		[216] = {14,765},
		[217] = {14,826},
		[218] = {14,885},
		[219] = {14,945},
		[220] = {15,6},
		[221] = {15,67},
		[222] = {15,127},
		[223] = {15,186},
		[224] = {15,246},
		[225] = {15,307},
		[226] = {15,368},
		[227] = {15,428},
		[228] = {15,487},
		[229] = {15,548},
		[230] = {15,608},
		[231] = {15,669},
		[232] = {15,728},
		[233] = {15,788},
		[234] = {15,849},
		[235] = {15,909},
		[236] = {15,970},
		[237] = {16,30},
		[238] = {16,89},
		[239] = {16,149},
		[240] = {16,210},
		[241] = {16,271},
		[242] = {16,330},
		[243] = {16,390},
		[244] = {16,451},
		[245] = {16,510},
		[246] = {16,571},
		[247] = {16,632},
		[248] = {16,692},
		[249] = {16,751},
		[250] = {16,812},
		[251] = {16,873},
		[252] = {16,932},
		[253] = {16,992},
		[254] = {17,53},
		[255] = {17,114},
		[256] = {17,173},
		[257] = {17,234},
		[258] = {17,294},
		[259] = {17,353},
		[260] = {17,414},
		[261] = {17,475},
		[262] = {17,535},
		[263] = {17,594},
		[264] = {17,655},
		[265] = {17,716},
		[266] = {17,775},
		[267] = {17,835},
		[268] = {17,896},
		[269] = {17,955},
		[270] = {18,16},
		[271] = {18,77},
		[272] = {18,137},
		[273] = {18,196},
		[274] = {18,257},
		[275] = {18,318},
		[276] = {18,378},
		[277] = {18,437},
		[278] = {18,498},
		[279] = {18,557},
		[280] = {18,618},
		[281] = {18,678},
		[282] = {18,739},
		[283] = {18,798},
		[284] = {18,859},
		[285] = {18,920},
		[286] = {18,980},
		[287] = {19,39},
		[288] = {19,100},
		[289] = {19,161},
		[290] = {19,221},
		[291] = {19,280},
		[292] = {19,341},
		[293] = {19,400},
		[294] = {19,461},
		[295] = {19,521},
		[296] = {19,582},
		[297] = {19,641},
		[298] = {19,702},
		[299] = {19,763},
		[300] = {19,823},
		[301] = {19,882},
		[302] = {19,943},
		[303] = {20,3},
		[304] = {20,64},
		[305] = {20,123},
		[306] = {20,184},
		[307] = {20,243},
		[308] = {20,303},
		[309] = {20,364},
		[310] = {20,425},
		[311] = {20,484},
		[312] = {20,545},
		[313] = {20,605},
		[314] = {20,666},
		[315] = {20,725},
		[316] = {20,786},
		[317] = {20,846},
		[318] = {20,907},
		[319] = {20,966},
		[320] = {21,27},
		[321] = {21,86},
		[322] = {21,146},
		[323] = {21,207},
		[324] = {21,268},
		[325] = {21,327},
		[326] = {21,388},
		[327] = {21,448},
		[328] = {21,509},
		[329] = {21,568},
		[330] = {21,629},
		[331] = {21,689},
		[332] = {21,748},
		[333] = {21,809},
		[334] = {21,870},
		[335] = {21,929},
		[336] = {21,989},
		[337] = {22,50},
		[338] = {22,111},
		[339] = {22,170},
		[340] = {22,231},
		[341] = {22,291},
		[342] = {22,350},
		[343] = {22,411},
		[344] = {22,472},
		[345] = {22,532},
		[346] = {22,591},
		[347] = {22,652},
		[348] = {22,713},
		[349] = {22,772},
		[350] = {22,832},
		[351] = {22,893},
		[352] = {22,954},
		[353] = {23,13},
		[354] = {23,74},
		[355] = {23,134},
		[356] = {23,193},
		[357] = {23,254},
		[358] = {23,315},
		[359] = {23,375},
		[360] = {23,434},
		[361] = {23,495},
		[362] = {23,556},
		[363] = {23,615},
		[364] = {23,675},
		[365] = {23,736},
		[366] = {23,795},
		[367] = {23,856},
		[368] = {23,917},
		[369] = {23,977},
		[370] = {24,36},
		[371] = {24,97},
		[372] = {24,158},
		[373] = {24,217},
		[374] = {24,277},
		[375] = {24,338},
		[376] = {24,397},
		[377] = {24,458},
		[378] = {24,518},
		[379] = {24,579},
		[380] = {24,638},
		[381] = {24,699},
		[382] = {24,760},
		[383] = {24,820},
		[384] = {24,879},
		[385] = {24,940},
		[386] = {25,1},
		[387] = {25,60},
		[388] = {25,120},
		[389] = {25,181},
		[390] = {25,240},
		[391] = {25,301},
		[392] = {25,361},
		[393] = {25,422},
		[394] = {25,481},
		[395] = {25,542},
		[396] = {25,603},
		[397] = {25,663},
		[398] = {25,722},
		[399] = {25,783},
		[400] = {25,843},
		[401] = {25,903},
		[402] = {25,963},
		[403] = {26,24},
		[404] = {26,83},
		[405] = {26,143},
		[406] = {26,204},
		[407] = {26,265},
		[408] = {26,324},
		[409] = {26,385},
		[410] = {26,445},
		[411] = {26,506},
		[412] = {26,565},
		[413] = {26,626},
		[414] = {26,686},
		[415] = {26,745},
		[416] = {26,806},
		[417] = {26,867},
		[418] = {26,926},
		[419] = {26,986},
		[420] = {27,47},
		[421] = {27,108},
		[422] = {27,167},
		[423] = {27,228},
		[424] = {27,288},
		[425] = {27,349},
		[426] = {27,408},
		[427] = {27,469},
		[428] = {27,528},
		[429] = {27,588},
		[430] = {27,649},
		[431] = {27,710},
		[432] = {27,769},
		[433] = {27,829},
		[434] = {27,890},
		[435] = {27,951},
		[436] = {28,10},
		[437] = {28,71},
		[438] = {28,131},
		[439] = {28,190},
		[440] = {28,251},
		[441] = {28,312},
		[442] = {28,371},
		[443] = {28,431},
		[444] = {28,492},
		[445] = {28,553},
		[446] = {28,612},
		[447] = {28,672},
		[448] = {28,733},
		[449] = {28,792},
		[450] = {28,853},
		[451] = {28,914},
		[452] = {28,974},
		[453] = {29,33},
		[454] = {29,94},
		[455] = {29,155},
		[456] = {29,214},
		[457] = {29,274},
		[458] = {29,335},
		[459] = {29,396},
		[460] = {29,455},
		[461] = {29,515},
		[462] = {29,576},
		[463] = {29,635},
		[464] = {29,696},
		[465] = {29,757},
		[466] = {29,817},
		[467] = {29,876},
		[468] = {29,937},
		[469] = {29,998},
		[470] = {30,57},
		[471] = {30,117},
		[472] = {30,178},
		[473] = {30,237},
		[474] = {30,298},
		[475] = {30,359},
		[476] = {30,419},
		[477] = {30,478},
		[478] = {30,539},
		[479] = {30,600},
		[480] = {30,660},
		[481] = {30,719},
		[482] = {30,780},
		[483] = {30,839},
		[484] = {30,900},
		[485] = {30,960},
		[486] = {31,21},
		[487] = {31,80},
		[488] = {31,141},
		[489] = {31,202},
		[490] = {31,262},
		[491] = {31,321},
		[492] = {31,382},
		[493] = {31,443},
		[494] = {31,503},
		[495] = {31,562},
		[496] = {31,623},
		[497] = {31,682},
		[498] = {31,743},
		[499] = {31,803},
		[500] = {31,864},
};

// returns log value with decimal and whole number parts as separate integers
void get_log(uint16_t raw, uint8_t *whole, uint16_t *decimal)
{
	uint16_t res = ((500*(raw & 0xffff))>>16);
	//convert raw data to units of 10mV
	*whole = dbfs[res].num;
	*decimal = dbfs[res].dec;
}
